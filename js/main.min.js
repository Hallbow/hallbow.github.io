(function(e,t){var n=t.body,a=t.querySelector.bind(t),o=t.querySelectorAll.bind(t),s=a("html"),r=a("#gotop"),l=a("#menu"),c=a("#header"),d=a("#mask"),f=a("#menu-toggle"),u=a("#menu-off"),v=a("#loading"),h=e.requestAnimationFrame,g=12,L=Array.prototype.forEach,m="ontouchstart"in e&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent)?"touchstart":"click",p=/micromessenger/i.test(navigator.userAgent),x=function(){},y=function(e){var t=e.offsetLeft,i=e.offsetTop;if(e.offsetParent){var n=arguments.callee(e.offsetParent);t+=n.x,i+=n.y}return{x:t,y:i}},w=navigator.userAgent.indexOf("Firefox")!==-1?t.documentElement:n,E={goTop:function(e){var t=w.scrollTop,i=arguments.length>2?arguments[1]:Math.abs(t-e)/g;t&&t>e?(w.scrollTop=Math.max(t-i,0),h(arguments.callee.bind(this,e,i))):e&&t<e?(w.scrollTop=Math.min(t+i,e),h(arguments.callee.bind(this,e,i))):this.toc.actived(e)},toggleGotop:function(t){t>e.innerHeight/2?r.classList.add("in"):r.classList.remove("in")},toggleMenu:function(t){var i=a("#main");if(t){if(l.classList.remove("hide"),e.innerWidth<1241)if(d.classList.add("in"),l.classList.add("show"),p){var n=w.scrollTop;i.classList.add("lock"),i.scrollTop=n}else s.classList.add("lock")}else if(l.classList.remove("show"),d.classList.remove("in"),p){var n=i.scrollTop;i.classList.remove("lock"),w.scrollTop=n}else s.classList.remove("lock")},fixedHeader:function(e){e>c.clientHeight?c.classList.add("fixed"):c.classList.remove("fixed")},toc:function(){var e=a("#post-toc");if(!e||!e.children.length)return{fixed:x,actived:x};var t=y(e),n=t.y,s=c.clientHeight,r=a("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");return e.querySelector('a[href="#'+r[0].id+'"]').parentNode.classList.add("active"),L.call(o('a[href^="#"]'),function(e){e.addEventListener("click",function(e){e.preventDefault();var t=y(a('[id="'+decodeURIComponent(this.hash).substr(1)+'"]')).y-s;h(E.goTop.bind(E,t))})}),{fixed:function(t){t>n-s?e.classList.add("fixed"):e.classList.remove("fixed")},actived:function(t){for(i=0,len=r.length;i<len;i++)if(t>y(r[i]).y-s-5){e.querySelector("li.active").classList.remove("active");var n=e.querySelector('a[href="#'+r[i].id+'"]').parentNode;n.classList.add("active")}t<y(r[0]).y&&(e.querySelector("li.active").classList.remove("active"),e.querySelector('a[href="#'+r[0].id+'"]').parentNode.classList.add("active"))}}}(),modal:function(e){function i(e){n.$modal.contains(e.target)||n.hide()}this.$modal=a(e),this.$off=this.$modal.querySelector(".close");var n=this;this.show=function(){d.classList.add("in"),n.$modal.classList.add("ready"),setTimeout(function(){n.$modal.classList.add("in"),t.addEventListener(m,i)},0)},this.hide=function(){d.classList.remove("in"),n.$modal.classList.remove("in"),setTimeout(function(){n.$modal.classList.remove("ready"),t.removeEventListener(m,i)},300)},this.toggle=function(){return n.$modal.classList.contains("in")?n.hide():n.show()},this.$off&&this.$off.addEventListener(m,this.hide)},share:function(){var e=a("#pageShare"),i=a("#shareFab"),n=new this.modal("#globalShare");a("#menuShare").addEventListener(m,n.toggle),i&&(i.addEventListener(m,function(){e.classList.toggle("in")},!1),t.addEventListener(m,function(t){!i.contains(t.target)&&e.classList.remove("in")},!1));var s=new this.modal("#wxShare");L.call(o(".wxFab"),function(e){e.addEventListener(m,s.toggle)})},search:function(){function e(){t.classList.toggle("in")}var t=a("#search-wrap");a("#search").addEventListener(m,e)},reward:function(){var e=new this.modal("#reward");a("#rewardBtn").addEventListener(m,e.toggle)},fixNavMinH:function(){function e(){t.style.minHeight=t.parentNode.clientHeight-t.nextElementSibling.offsetHeight+"px"}var t=a(".nav");return e}(),waterfall:function(){e.innerWidth<760||L.call(o(".waterfall"),function(e){var t=e.querySelectorAll(".waterfall-item"),i=[0,0];L.call(t,function(e){var t=i[0]<=i[1]?0:1;e.style.cssText="top:"+i[t]+"px;left:"+(t>0?"50%":0),i[t]+=e.offsetHeight}),e.style.height=Math.max(i[0],i[1])+"px",e.classList.add("in")})},tabBar:function(e){e.parentNode.parentNode.classList.toggle("expand")},page:function(){var e=o(".fade, .fade-scale");return{loaded:function(){L.call(e,function(e){e.classList.add("in")})},unload:function(){L.call(e,function(e){e.classList.remove("in")})}}}()};e.addEventListener("load",function(){E.fixNavMinH(),E.waterfall();var e=w.scrollTop;E.toc.fixed(e),E.toc.actived(e),v.classList.remove("active"),E.page.loaded()}),e.addEventListener("beforeunload",function(){E.page.unload()}),e.addEventListener("resize",function(){e.BLOG.even=m="ontouchstart"in e?"touchstart":"click",E.fixNavMinH(),E.toggleMenu(),E.waterfall()}),r.addEventListener(m,function(){h(E.goTop.bind(E,0))},!1),f.addEventListener(m,function(e){E.toggleMenu(!0),e.preventDefault()},!1),u.addEventListener(m,function(){l.classList.add("hide")},!1),d.addEventListener(m,function(){E.toggleMenu()},!1),t.addEventListener("scroll",function(){var e=w.scrollTop;E.toggleGotop(e),E.fixedHeader(e),E.toc.fixed(e),E.toc.actived(e)},!1),e.BLOG.SHARE&&E.share(),e.BLOG.REWARD&&E.reward(),E.docEl=w,E.noop=x,E.even=m,E.$=a,E.$$=o,Object.keys(E).reduce(function(e,t){return e[t]=E[t],e},e.BLOG),Waves.init(),Waves.attach(".global-share li",["waves-block"]),Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])})(window,document);